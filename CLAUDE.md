# J-Flash - LLM 기반 일본어 학습 가이드라인

## 프로젝트 개요

J-Flash는 LLM(Claude)을 활용하여 일본어 교재 이미지에서 단어와 문법을 추출하고, SRS(Spaced Repetition System)로 복습하는 일본어 학습 앱입니다.

### 아키텍처
```
[이미지] → [Claude 추출] → [JSON 저장] → [Git Push] → [Web 복습]
```

- **Full Mode**: 로컬 환경에서 단어 추가/수정/삭제 가능
- **Lite Mode**: 웹 환경에서 복습만 가능 (읽기 전용)

---

## 이미지 추출 워크플로우

### 방법 1: Claude Code CLI (권장)

Claude Code에서 이미지를 첨부하고 "단어 추출" 또는 "문장 추출" 요청 시 **자동으로** 처리됩니다.

```
사용자: [이미지 첨부] 단어 추출해줘
Claude Code:
1. 이미지에서 단어 추출
2. words.json 파일에 자동 저장
3. git commit & push
4. GitHub Actions → Supabase 자동 동기화
```

### 방법 2: Claude 앱 (모바일/웹)

Claude 앱에서는 파일을 직접 수정할 수 없으므로, JSON 출력 후 수동으로 복사해야 합니다.

**프롬프트 예시:**
```
이 일본어 교재 이미지에서 단어를 추출해서 JSON 배열로 만들어줘.

## 규칙
1. 이미지에 보이는 단어만 (환각 금지)
2. 조사(は,が,を,に,で), 조동사(です,ます,た,ない) 제외
3. 동사는 사전형으로 (食べた → 食べる)
4. 예문 필수 - 없으면 자연스럽게 생성
5. 의미는 한국어로
6. id는 [마지막 ID + 1]부터 시작

## 출력 형식
[
  {"id": 62, "kanji": "...", "reading": "...", "meaning": "...", "pos": "...", "jlpt_level": "N5", "example_sentence": "...", "example_meaning": "..."}
]
```

**수동 적용 방법:**
1. Claude가 출력한 JSON 복사
2. `frontend/public/data/words.json` 파일 열기
3. 배열 끝에 새 항목 추가 (마지막 `]` 앞에)
4. 저장 후 커밋 & 푸시

---

### 추출 규칙

| 사용자 요청 | 모드 | pos 값 | 저장 파일 |
|-------------|------|--------|-----------|
| "단어 추출" | 단어 모드 | 名詞, 動詞, 形容詞 등 | words.json |
| "문장 추출" | 문장 모드 | 文 | sentences.json |

**이미지 처리:**
- 이미지에 보이는 단어/문장만 추출 (환각 금지)
- 조사, 조동사 제외
- 동사는 사전형으로 정규화
- 예문 필수 (없으면 생성)

---

### JSON 스키마

**단어:**
```json
{
  "id": 1,
  "kanji": "食べる",
  "reading": "たべる",
  "meaning": "먹다",
  "pos": "動詞",
  "jlpt_level": "N5",
  "example_sentence": "朝ごはんを食べます。",
  "example_meaning": "아침밥을 먹습니다.",
  "notes": "【분해】食(먹을 식) + べる(하단활용)\n【문법】~ている: 진행/상태\n【관련】飲む(のむ, 마시다)"
}
```

### notes 필드 가이드라인

복습 시 표시되는 해설입니다. 다음 요소를 포함할 수 있습니다:

| 태그 | 설명 | 예시 |
|------|------|------|
| 【분해】 | 한자 구성요소, 어원 | 銀行 = 銀(은) + 行(가다/행) |
| 【문법】 | 관련 문법 패턴 | ~ている: 진행/상태 표현 |
| 【관련】 | 유의어, 반의어, 관련어 | 類: 見る / 反: 聞く |
| 【주의】 | 사용 주의사항, 뉘앙스 | 丁寧語에서는 召し上がる 사용 |
| 【발음】 | 발음 주의, 악센트 | 雨(あめ)↓ vs 飴(あめ)↑ |

**작성 규칙:**
- 줄바꿈은 `\n`으로 구분
- 모든 태그를 포함할 필요 없음 (필요한 것만)
- 간결하게 작성 (복습 시 빠르게 확인할 수 있도록)

**문장:**
```json
{
  "id": 15,
  "kanji": "ぼくは学生。",
  "reading": "ぼくはがくせい。",
  "meaning": "나는 학생이야.",
  "pos": "文",
  "jlpt_level": "N5",
  "example_sentence": "",
  "example_meaning": ""
}
```

---

### 처리 규칙 (Claude Code 자동 처리)

1. 기존 JSON 파일 읽기
2. 마지막 id 확인 후 새 id 부여
3. 중복 확인 (동일 kanji + reading → 스킵)
4. 새 항목 추가 후 저장
5. Git 커밋 & 푸시
6. 결과 테이블 출력:

| id | 단어 | 읽기 | 의미 | 품사 |
|----|------|------|------|------|

---

## LLM 단어 추출 가이드라인

### 1. 핵심 원칙: 환각 방지

```
❌ 금지: OCR 텍스트에 없는 단어 생성
✅ 필수: 실제 이미지에 존재하는 토큰만 추출
```

**검증 방법**: 추출된 모든 단어는 원본 이미지에서 확인 가능해야 함

### 2. 기본형 정규화

| 필드 | 설명 | 예시 |
|------|------|------|
| `surface` | 원문 그대로 (활용형) | 勉強した |
| `kanji` | 사전형 (기본형) | 勉強する |
| `reading` | 히라가나 읽기 | べんきょうする |

### 3. 제외 항목

다음 품사/항목은 단어장에 추가하지 않습니다:

- **조사**: は, が, を, に, で, と, も, から, まで, より, へ
- **조동사**: です, ます, た, ない, れる, られる
- **기호/숫자만**: 1, 2, !, ? 등
- **1글자 히라가나**: あ, い, う, え, お

### 4. 신뢰도 기준

| confidence | 처리 | needs_review |
|------------|------|--------------|
| ≥ 0.8 | 자동 저장 | 0 |
| 0.5 ~ 0.8 | 저장 + 검토 표시 | 1 |
| < 0.5 | 경고 반환, 재촬영 권장 | - |

### 5. 중복 처리

```
동일 lemma → 1개로 병합
다양한 표기 → surface에 보존
```

---

## 출력 스키마

### 입력
- 이미지 파일 (교재 사진)
- 메타 정보: 페이지 번호, 교재명 (선택)

### 출력 JSON 형식

```json
{
  "status": "ok",
  "source_context": "みんなの日本語 1課",
  "words": [
    {
      "surface": "勉強した",
      "kanji": "勉強する",
      "reading": "べんきょうする",
      "meaning": "공부하다",
      "pos": "動詞",
      "jlpt_level": "N5",
      "example_sentence": "毎日日本語を勉強する。",
      "example_meaning": "매일 일본어를 공부한다.",
      "confidence": 0.9
    }
  ],
  "grammar": [
    {
      "title": "〜は〜です",
      "meaning": "~은/는 ~입니다",
      "description": "명사 술어문의 기본 형태",
      "level": "N5",
      "example": "私は学生です。",
      "example_meaning": "저는 학생입니다."
    }
  ],
  "warnings": []
}
```

### 경고 유형
- `low_ocr_quality`: 이미지 품질 낮음
- `many_unknown_chars`: 인식 불가 문자 다수
- `needs_manual_review`: 수동 검토 권장

---

## 품사(POS) 값

| 값 | 한국어 | 설명 |
|----|--------|------|
| 名詞 | 명사 | 사람, 사물, 개념 |
| 動詞 | 동사 | 동작, 상태 |
| 形容詞 | 형용사 | い형용사 |
| 副詞 | 부사 | 정도, 빈도 |
| 接続詞 | 접속사 | 문장 연결 |
| 感動詞 | 감동사 | 감탄 |
| 連体詞 | 연체사 | 수식어 |

---

## 학습 효율 전략

### A. 신규 단어 제한
- 하루 신규: 10~20개로 시작
- 정답률 80% 이상 → 증가 허용
- 오답률 높으면 → 신규 투입 감소

### B. 복습 모드 (4종)

| 모드 | 앞면 | 뒷면 |
|------|------|------|
| 기본 | 彼 | かれ / 남자친구 |
| 역방향 | 남자친구 | 彼 (かれ) |
| 듣기 | 🔊 TTS | 彼 / 남자친구 |
| 빈칸 | ___は学生です | 彼 |

### C. SRS 간격
```
초기: 당일 → 다음날 → 3일 → 7일 → 14일 → 30일
오답: 즉시 1일로 축소
연속 5회 정답: 숙달 분류
```

### D. 예문 학습 (필수)

**원칙**: 단어만 외우지 말고, 반드시 예문과 함께 학습

| 단어만 | 예문과 함께 |
|--------|-------------|
| 彼 = 그 | 彼は学生です。 (그는 학생입니다) |
| 理解력 낮음 | 실제 용법 체득 |

**추출 시 예문 포함 필수**:
```json
{
  "kanji": "勉強する",
  "example_sentence": "毎日日本語を勉強します。",
  "example_meaning": "매일 일본어를 공부합니다."
}
```

- 교재에 예문이 있으면 반드시 함께 추출
- 예문이 없으면 LLM이 자연스러운 예문 생성
- 모든 복습 모드에서 뒷면에 예문 표시

### E. 맥락 강화
- 원문 예문 저장 (example_sentence)
- 출처 정보 보존 (source_context)

---

## 데이터베이스 스키마

### Vocabulary 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | INTEGER | PK |
| kanji | TEXT | 기본형 (사전형) |
| reading | TEXT | 히라가나 읽기 |
| meaning | TEXT | 한국어 의미 |
| pos | TEXT | 품사 |
| source_img | TEXT | 이미지 경로 |
| source_img_data | BLOB | 이미지 바이트 |
| created_at | DATETIME | 생성일 |
| jlpt_level | TEXT | N5~N1 |
| example_sentence | TEXT | 예문 |
| example_meaning | TEXT | 예문 해석 |
| source_context | TEXT | 출처 (교재/페이지) |
| confidence | REAL | LLM 신뢰도 0~1 |
| surface | TEXT | 원문 표기 |
| needs_review | INTEGER | 검토 필요 여부 |

### SRS_Review 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | INTEGER | PK |
| vocab_id | INTEGER | FK → Vocabulary |
| interval | INTEGER | 복습 간격 (일) |
| ease_factor | REAL | 난이도 계수 |
| next_review | DATETIME | 다음 복습일 |
| reps | INTEGER | 정답 횟수 |

### Grammar 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | INTEGER | PK |
| title | TEXT | 문법 패턴 |
| meaning | TEXT | 한국어 의미 |
| description | TEXT | 설명 |
| example | TEXT | 예문 |
| example_meaning | TEXT | 예문 해석 |
| level | TEXT | JLPT 레벨 |
| similar_patterns | TEXT | 유사 문법 |
| usage_notes | TEXT | 사용 주의사항 |

---

---

## 스크립트

### npm run split
vocabulary.json을 words.json과 sentences.json으로 분리합니다.

```bash
npm run split
```

### npm run archive
마스터된 항목(reps ≥ 5, interval ≥ 30)을 JLPT 레벨별 파일로 아카이브합니다.

```bash
# Supabase에서 SRS 데이터 가져와서 아카이브
npm run archive

# 또는 로컬 파일 사용
# 1. 브라우저에서: localStorage.getItem('jflash_srs_state')
# 2. scripts/srs-state.json에 저장
# 3. npm run archive
```

### npm run sync:supabase
JSON 파일을 Supabase vocabulary 테이블에 동기화합니다.

```bash
npm run sync:supabase
```

**GitHub Actions 자동 동기화**:
- `frontend/public/data/**` 파일이 main에 push되면 자동 실행
- GitHub Secrets 필요: `SUPABASE_URL`, `SUPABASE_SERVICE_KEY`

---

## 데이터 파일 구조

```
frontend/public/data/
├── words.json          # 학습 중인 단어 (pos ≠ 文)
├── sentences.json      # 학습 중인 문장 (pos = 文)
└── mastered/           # 마스터된 항목 (JLPT 레벨별)
    ├── N5.json
    ├── N4.json
    ├── N3.json
    ├── N2.json
    ├── N1.json
    └── unknown.json
```

---

## Supabase 테이블

### vocabulary
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | INTEGER | PK |
| kanji | TEXT | 단어/문장 |
| reading | TEXT | 읽기 |
| meaning | TEXT | 의미 |
| pos | TEXT | 품사 |
| jlpt_level | TEXT | JLPT 레벨 |
| example_sentence | TEXT | 예문 |
| example_meaning | TEXT | 예문 해석 |
| notes | TEXT | 추가 설명 |
| status | TEXT | active / mastered |

### srs_records
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | SERIAL | PK |
| device_id | UUID | 기기 식별자 |
| vocab_id | INTEGER | 단어 ID |
| interval | INTEGER | 복습 간격 (일) |
| ease_factor | REAL | 난이도 계수 |
| next_review | TIMESTAMP | 다음 복습일 |
| reps | INTEGER | 정답 횟수 |

---

## 버전 정보

- **앱 버전**: 2.1.0
- **데이터**: Static JSON + Supabase 동기화
- **복습 모드**: 6종 (기본, 역방향, 듣기, 빈칸, 문장, **설명(파인만)**)

---

## 90일 학습 최적화 로드맵

### 핵심 원리

10배 빠른 학습을 위한 과학적 기법 통합:

| 기법 | 설명 | 적용 |
|------|------|------|
| **파인만 기법** | 설명하면서 배우기 | 설명 모드 (feynman) |
| **FSRS 간격 반복** | 망각곡선 기반 최적 타이밍 | 자동 복습 스케줄링 |
| **Active Recall** | 능동적 기억 인출 | 역방향, 빈칸, 설명 모드 |
| **Interleaving** | 혼합 학습 | 셔플 옵션 |
| **Chunking** | 적정량 유지 | 일일 목표 설정 |

---

### Phase 1: 기초 다지기 (Day 1-30)

**목표**: N5 단어 + 기본 문법 패턴

| 항목 | 권장값 |
|------|--------|
| 일일 신규 단어 | 10개 |
| 일일 복습 | 30개 |
| 권장 모드 | 기본, 듣기 |

**학습 전략**:
1. 기본 모드로 단어 → 의미 학습
2. 듣기 모드로 발음 익히기 (매일 10분)
3. 파인만 모드: 배운 단어로 간단한 문장 만들기

**체크리스트**:
- [ ] 히라가나/가타카나 완벽 숙지
- [ ] 기본 인사/자기소개 표현
- [ ] 숫자, 시간, 요일 표현
- [ ] 기본 동사 활용 (ます형)

---

### Phase 2: 확장 & 심화 (Day 31-60)

**목표**: N4 단어 + 문장 구조 이해

| 항목 | 권장값 |
|------|--------|
| 일일 신규 단어 | 15개 |
| 일일 복습 | 50개 |
| 권장 모드 | 역방향, 빈칸, 설명 |

**학습 전략**:
1. 역방향 모드: 의미 → 단어 (Active Recall 강화)
2. 빈칸 모드: 문맥 속 단어 사용법
3. 파인만 모드: 학습한 문법을 다른 사람에게 설명하듯 정리

**체크리스트**:
- [ ] て형, た형 활용
- [ ] 형용사 활용 (い/な)
- [ ] 조건문 (たら、ば、と、なら)
- [ ] 수동형, 사역형 기초

---

### Phase 3: 유창성 도달 (Day 61-90)

**목표**: N3+ 단어 + 자연스러운 표현

| 항목 | 권장값 |
|------|--------|
| 일일 신규 단어 | 20개 |
| 일일 복습 | 80개 |
| 권장 모드 | 문장, 혼합 |

**학습 전략**:
1. 문장 모드: 완전한 문장 단위 학습
2. 혼합 복습: 모든 모드 랜덤 섞기 (셔플 ON)
3. 파인만 모드: 일본어로 짧은 일기 쓰기

**체크리스트**:
- [ ] 경어 (敬語) 기본
- [ ] 복합동사 이해
- [ ] 관용표현 50개+
- [ ] 뉴스/기사 간단히 읽기

---

### 파인만 기법 적용 가이드

**설명 모드 (feynman) 사용법**:

1. 단어가 표시되면 **자신의 말로 설명** 작성
2. 예: "食べる" → "음식을 입에 넣고 씹어서 삼키는 행위"
3. 확인 후 정답과 비교
4. 설명이 부족했다면 "모름" 선택

**효과적인 설명 작성법**:

| 프롬프트 유형 | 예시 |
|---------------|------|
| 초등학생에게 설명 | "勉強する는 책을 보면서 새로운 것을 배우는 거야" |
| 예문 만들기 | "私は毎日日本語を勉強します" |
| 비교하기 | "見る(보다)와 비슷하지만, 観る는 영화나 공연을 볼 때 씀" |
| 상황 설명 | "친구 집에 놀러갔을 때 '遊ぶ'를 사용" |

---

### 일일 학습 루틴

**추천 시간**: 30-45분

```
1. 워밍업 (5분)
   - 어제 틀린 단어 빠르게 복습
   - 듣기 모드로 발음 확인

2. 복습 (15분)
   - 오늘 복습 필요한 카드 처리
   - 정답률 80% 유지 목표

3. 신규 학습 (10분)
   - 설정된 일일 신규 단어 학습
   - 기본 모드 → 설명 모드 순서

4. 심화 (10분)
   - 역방향 또는 빈칸 모드
   - 파인만 모드로 정리

5. 마무리 (5분)
   - 오늘 어려웠던 단어 다시 확인
   - 내일 학습 목표 확인
```

---

### 정답률 기반 조절

| 정답률 | 권장 조치 |
|--------|----------|
| 90%+ | 신규 단어 +5개 증가 |
| 80-90% | 현재 페이스 유지 |
| 70-80% | 신규 단어 유지, 복습에 집중 |
| 70% 미만 | 신규 단어 -5개, 복습 우선 |

**앱 내 확인**: 統計 (통계) 페이지에서 확인 가능

---

### 스트릭 & 동기부여

**연속 학습의 힘**:
- 7일 연속: 습관 형성 시작
- 21일 연속: 습관 고정
- 66일 연속: 자동화된 습관

**스트릭 유지 팁**:
1. 같은 시간에 학습 (아침 or 저녁)
2. 최소 5분이라도 매일
3. 주말에도 가볍게 복습

통계 페이지에서 연속 학습일, 총 학습일, 최장 기록 확인 가능
